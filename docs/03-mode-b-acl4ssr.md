<!-- docs/03-mode-b-acl4ssr.md -->
# 模式 B：内置模板分组/规则（订阅前缀 ns/…）

← [返回 README](../README.md)  
← 上一篇：[模式 A：保留订阅原始结构](02-mode-a-preserve.md)  
→ 下一篇：[准备订阅片段 YAML & 导入流程](04-snippets-and-import.md)

> 模式 B 适合：你不想保留订阅自带的复杂 group/rules，所有端口统一使用内置模板分组/规则（规则列表来源于 ACL4SSR）。

---

## 1) 模式 B 的核心目标

- 不读取/合并订阅片段里的 `proxy-groups` 与 `rules`（只导入节点与 provider）
- 每个订阅端口使用自己的 `sub-rules: template_<ns>`
- 模板分组/规则内置在脚本中（不依赖 `template.yaml`）

---

## 2) 模板分组如何注入节点

- 模板组的 `proxies` 列表里用 `LEAF` 表示“该组需要节点”
- **远程订阅**：为该组加入 `use: [ns]`
- **本地订阅**：把本地 `proxies` 填入该组
- 未标记 `LEAF` 的组只保留 builtin 与组引用

---

## 3) ALL 级分组与全局规则

- 为每个模板组生成一个 `ALL/<组名>` 分组
- 全局 `rules` 使用模板规则，并把策略重写为 `ALL/<组名>`

---

## 4) 模式 B 的优缺点

优点：
- 规则体系统一、易理解、易维护
- 订阅之间不会互相污染 group 名（全是 `ns/` 前缀）
- 适合快速稳定地跑起来

缺点：
- 订阅自带的复杂分组树会被抛弃
- 如果你很依赖订阅自带的细分策略组，需要回到模式 A 或自行扩展模板

---

下一篇：
→ [准备订阅片段 YAML & 导入流程](04-snippets-and-import.md)
